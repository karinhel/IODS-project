
# Chapter 3 ~ Logistic Regression


Let's start working by opening the dataset with read.table -command and taking a look at the structure of it. The data has been previously merged from two different files.

```{r}
alc <- read.table(file= "http://s3.amazonaws.com/assets.datacamp.com/production/course_2218/datasets/alc.txt ", header=T, sep=",")

colnames(alc)

```

The data addresses alcohol consumptions among 15 to 22 aged students in math and portuguese language courses. The 33 variables that can be seen upon include questions about studying times, grades, other topics related to school, backround information about the person, his/her family and social status and finally alcohol spending on week days and weekends. There are two additional variables; "alc_use" and "high_use". Alc_use tells the average of week day and weekend alcohol consumption and high_use is a logical vector, which is true if alc_use is higher than two.

At this chapter, the purpose is to study the relationship between four picked variables and the variable "hig_use". We now choose next four variables; 

* "goout"      Going out with friends
* "famrel"     Quality of family relationships
* "studytime"  Weekly studytime in hours
* "sex"        Obviously female/male

to explain higher use of alcohol among the study group. One could predict that going out with friends is the best variable to explain alcohol consumption. Family relationships could have a small effect as well as the studytime. Maybe high_use would better explain the weekly studying time than other way around. Sex can have a bigger explanation power on high_use but not as big as the first variable "goout".

First we study the relationships between single variables. By crosstabulation and grahps.

```{r, echo=F}
library(tidyr);library(dplyr);library(ggplot2)

```

```{r}

alc %>% group_by(high_use, sex) %>% summarise(count = n(), mean_goout=mean(goout), mean_famrel=mean(famrel), mean_studytime=mean(studytime))
```

We see that when high_use is true, the mean of going out with friends is greater for both sex. For other two variables we have rather sex divided differencies than a division for false and true high_use values. Here are also some bar graphs, that are merged into one picture with help of [this](http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/) page.

```{r, echo=F}
# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

```{r}
g1 <- ggplot(alc, aes(x = goout, fill=high_use)) + geom_bar() + xlab("Going out with friends")

g2 <- ggplot(alc, aes(x = famrel, fill=high_use)) + geom_bar() + xlab("Quality of family relationships")

g3 <- ggplot(alc, aes(x = studytime, fill=high_use)) + geom_bar() + xlab("Weekly studying time in hours")

g4 <- ggplot(alc, aes(x = sex, fill=high_use)) + geom_bar() + xlab("Gender")

multiplot(g1, g2, g3, g4, cols=2)
```


Next we will fit a model with these four variables as explanatory and high_use as the result variable.

```{r}
Log <- glm(high_use ~ goout + famrel + studytime + sex, data = alc, family = "binomial")

summary(Log)

```

It seems that the explanatory variables aren't that bad. "goout" has at least a very significant p-value, because it is near to zero and also the other three variables have a significant enough p-values; 0.001, 0.005 and 0.004. 


After the model has been fit we can count some OR-values for the parameters.

```{r}


```



Finally, after all fitting and counting it is possible to make some predictions with the fitted model.

```{r}

```








